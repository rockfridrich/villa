#!/bin/bash
# Pre-push hook: Fast verification before pushing
# Full E2E tests run in CI - this is just a quick sanity check
#
# Fast checks (~30s): typecheck + lint
# Slow checks (CI): E2E tests, security scans
#
# For full local verification: pnpm verify

set -e

echo "üîç Running fast pre-push checks..."
echo ""

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "‚ùå Not in project root, skipping verification"
    exit 0
fi

# Fast verification: typecheck + lint only
# This catches 80% of issues in 20% of the time
if pnpm typecheck && pnpm lint; then
    echo ""
    echo "‚úÖ Fast checks passed. Pushing..."
    echo "üìä Full E2E tests will run in CI"
    echo ""

    # Start background CI monitor (non-blocking)
    if [ -x "./scripts/ci-monitor.sh" ]; then
        echo "üîÑ CI monitor will track status in background..."
        # Note: This runs after push completes
        # To enable: nohup ./scripts/ci-monitor.sh --watch >> .claude/ci-status.log 2>&1 &
    fi

    exit 0
else
    echo ""
    echo "‚ùå Fast verification failed. Fix issues before pushing."
    echo ""
    echo "Run 'pnpm typecheck' and 'pnpm lint' to see errors"
    echo "To bypass (not recommended): git push --no-verify"
    exit 1
fi
