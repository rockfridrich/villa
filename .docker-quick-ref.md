# Docker Quick Reference

One-page cheat sheet for Villa Docker development.

## Common Commands

```bash
# Start database only (most common)
docker compose up -d

# Development mode (db + https)
pnpm docker:dev

# Stop everything
pnpm docker:down

# View logs
pnpm docker:logs

# Clean everything (removes volumes!)
pnpm docker:clean
```

## Profiles

| Profile | Services | Command |
|---------|----------|---------|
| Default | postgres | `docker compose up -d` |
| `dev` | postgres + caddy | `pnpm docker:dev` |
| `https` | caddy only | `pnpm docker:https` |
| `test` | postgres-test + tests | `pnpm docker:test` |
| `full` | all services | `pnpm docker:full` |

## Testing

```bash
# All tests in Docker
pnpm docker:test

# Unit tests only
pnpm docker:test:unit

# E2E tests only
pnpm docker:test:e2e

# Legacy script-based tests
pnpm test:docker:all
```

## Database

```bash
# Start
pnpm db:start

# Stop
pnpm db:stop

# Reset (deletes data!)
pnpm db:reset

# View logs
pnpm db:logs

# Connect
docker compose exec postgres psql -U villa -d villa_dev
```

## URLs

| Service | URL | Use |
|---------|-----|-----|
| Next.js (native) | http://localhost:3000 | Development |
| HTTPS (Caddy) | https://local.villa.cash | Passkey testing |
| HTTPS (alt) | https://localhost | Passkey testing |
| PostgreSQL | localhost:5432 | Database GUI |
| API (if running) | http://localhost:3001 | API testing |

## Troubleshooting

| Problem | Solution |
|---------|----------|
| Port in use | `lsof -i :5432 && kill -9 <PID>` |
| Connection refused | Check `docker compose ps postgres` shows "healthy" |
| Caddy unhealthy | `docker compose restart caddy` |
| Hot reload broken | Use hybrid mode (native Next.js) |
| Out of memory | Increase Docker memory or use hybrid mode |

## Environment

```bash
# Copy defaults
cp .env.docker .env

# Key variables
DATABASE_URL=postgresql://villa:villa_dev_password@localhost:5432/villa_dev
CADDYFILE=./Caddyfile.local
```

## More Info

See [DOCKER.md](DOCKER.md) for comprehensive documentation.
